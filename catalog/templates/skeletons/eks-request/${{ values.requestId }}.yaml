# EKS Request Contract
# Auto-generated by Backstage self-service template
# Schema: schemas/requests/eks.schema.yaml
---
id: ${{ values.requestId }}
environment: ${{ values.environment }}
region: ${{ values.region }}
owner: ${{ values.owner }}
requester: ${{ values.requester }}
clusterLifecycle: ${{ values.clusterLifecycle }}

metadata:
  title: "EKS Cluster - ${{ values.environment }}"
  description: "${{ values.description }}"

spec:
  mode: ${{ values.mode }}
{%- if values.buildId %}
  build:
    buildId: ${{ values.buildId }}
{%- endif %}
  cluster:
    clusterName: ${{ values.clusterName }}
    kubernetesVersion: "${{ values.kubernetesVersion }}"
    privateEndpointOnly: {{ values.privateEndpointOnly }}
    irsa:
      enabled: {{ values.irsaEnabled }}
    access:
      ssmBreakGlass: {{ values.ssmBreakGlass }}
      sshBreakGlass: {{ values.sshBreakGlass }}
{%- if values.sshKeyName %}
      sshKeyName: {{ values.sshKeyName }}
{%- endif %}
      sshSourceSgIds:
{%- for sg in values.sshSourceSgIds %}
        - {{ sg }}
{%- endfor %}
  nodePool:
    nodeTier: {{ values.nodeTier }}
    nodeMin: {{ values.nodeMin }}
    nodeDesired: {{ values.nodeDesired }}
    nodeMax: {{ values.nodeMax }}
    capacityType: {{ values.capacityType }}
    autoscaler:
      enabled: {{ values.autoscalerEnabled }}
  gitops:
    controller: {{ values.gitopsController }}
    install: {{ values.gitopsInstall }}
    bootstrapProfile: {{ values.bootstrapProfile }}
  ingress:
    provider: {{ values.ingressProvider }}
    awsLbType: {{ values.awsLbType }}
    internal: {{ values.ingressInternal }}
