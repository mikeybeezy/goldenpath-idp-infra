# EKS Request Contract
# Auto-generated by Backstage self-service template
# Schema: schemas/requests/eks.schema.yaml
---
id: ${{ values.request_id }}
environment: ${{ values.environment }}
region: ${{ values.region }}
owner: ${{ values.owner }}
requester: ${{ values.requester }}
cluster_lifecycle: ${{ values.cluster_lifecycle }}

metadata:
  title: "EKS Cluster - ${{ values.environment }}"
  description: "${{ values.description }}"

spec:
  mode: ${{ values.mode }}
{%- if values.build_id %}
  build:
    build_id: ${{ values.build_id }}
{%- endif %}
  cluster:
    name: ${{ values.cluster_name }}
    kubernetes_version: "${{ values.kubernetes_version }}"
    private_endpoint_only: {{ values.private_endpoint_only }}
    irsa:
      enabled: {{ values.irsa_enabled }}
    access:
      ssm_break_glass: {{ values.ssm_break_glass }}
      ssh_break_glass: {{ values.ssh_break_glass }}
{%- if values.ssh_key_name %}
      ssh_key_name: {{ values.ssh_key_name }}
{%- endif %}
      ssh_source_sg_ids:
{%- for sg in values.ssh_source_sg_ids %}
        - {{ sg }}
{%- endfor %}
  node_pool:
    node_tier: {{ values.node_tier }}
    min: {{ values.node_min }}
    desired: {{ values.node_desired }}
    max: {{ values.node_max }}
    capacity_type: {{ values.capacity_type }}
    autoscaler:
      enabled: {{ values.autoscaler_enabled }}
  gitops:
    controller: {{ values.gitops_controller }}
    install: {{ values.gitops_install }}
    bootstrap_profile: {{ values.bootstrap_profile }}
  ingress:
    provider: {{ values.ingress_provider }}
    aws_lb_type: {{ values.aws_lb_type }}
    internal: {{ values.ingress_internal }}
