---
# ExternalSecret: Keycloak Admin Credentials
# Syncs admin password from AWS Secrets Manager
# NOTE: This secret needs to be manually created or managed separately
# Path: goldenpath/dev/keycloak/admin with key "admin-password"
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: keycloak-admin-secret
  namespace: keycloak
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secretsmanager
  target:
    name: keycloak-admin-secret
    creationPolicy: Owner
  data:
    - secretKey: admin-password
      remoteRef:
        key: goldenpath/dev/keycloak/admin
        property: admin-password
---
# ExternalSecret: Keycloak PostgreSQL Credentials (External RDS)
# Syncs from Terraform-managed secret at goldenpath/dev/keycloak/postgres
# Contains: username, password, host, port, dbname
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: keycloak-postgres-secret
  namespace: keycloak
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secretsmanager
  target:
    name: keycloak-postgres-secret
    creationPolicy: Owner
  data:
    # Database host (RDS endpoint)
    - secretKey: host
      remoteRef:
        key: goldenpath/dev/keycloak/postgres
        property: host
    # Database port
    - secretKey: port
      remoteRef:
        key: goldenpath/dev/keycloak/postgres
        property: port
    # Database username
    - secretKey: username
      remoteRef:
        key: goldenpath/dev/keycloak/postgres
        property: username
    # Database password
    - secretKey: password
      remoteRef:
        key: goldenpath/dev/keycloak/postgres
        property: password
    # Alias for helm charts that expect postgres-password
    - secretKey: postgres-password
      remoteRef:
        key: goldenpath/dev/keycloak/postgres
        property: postgres-password
