# Managed by scripts/standardize_metadata.py
governance:
  id: HELM_EXTERNAL_DNS_METADATA
  owner: platform-team
  risk_profile: low
  reliability: bronze

# -----------------------------------------------------------------------------
# Global Values (ADR-0179: Dynamic Hostname Generation)
# -----------------------------------------------------------------------------
global:
  hostSuffix: dev.goldenpathidp.io

# -----------------------------------------------------------------------------
# Image Configuration - Pinned Version
# -----------------------------------------------------------------------------
image:
  repository: registry.k8s.io/external-dns/external-dns
  tag: "v0.14.0"
  pullPolicy: IfNotPresent

# -----------------------------------------------------------------------------
# Provider + Registry (ADR-0178: DNS Ownership Contract)
# -----------------------------------------------------------------------------
# CRITICAL: domainFilters MUST match the Route53 hosted zone name (goldenpathidp.io)
# not a subdomain (dev.goldenpathidp.io). ExternalDNS uses domainFilters to find
# which hosted zone to use. If the filter is a subdomain, it won't find a matching zone.
#
# The txt-owner-id scopes record ownership per environment:
#   - Persistent: txtOwnerId=goldenpath-dev
#   - Ephemeral:  txtOwnerId=goldenpath-dev-{buildId}
# -----------------------------------------------------------------------------
provider: aws
policy: sync
registry: txt
txtOwnerId: "goldenpath-dev"
txtPrefix: "external-dns"

# Domain filter MUST match the hosted zone name, NOT a subdomain
domainFilters:
  - goldenpathidp.io

# Explicit zone ID filter ensures ExternalDNS targets the correct hosted zone
zoneIdFilters:
  - Z0032802NEMSL43VHH4E

sources:
  - service
  - ingress
logLevel: info

extraArgs:
  - --aws-zone-type=public

env:
  - name: AWS_DEFAULT_REGION
    value: eu-west-2

rbac:
  create: true

serviceAccount:
  create: false
  name: external-dns
