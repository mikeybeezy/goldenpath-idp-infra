# Kong Helm Values - Dev Environment
# Chart: konghq/kong v2.47.0
# Managed by scripts/standardize_metadata.py
governance:
  id: HELM_KONG_METADATA
  owner: null
  risk_profile: null
  reliability: null

# -----------------------------------------------------------------------------
# Global Values (ADR-0179: Dynamic Hostname Generation)
# NOTE: Kong chart is upstream and doesn't template annotations from values.
# For ephemeral deployments, override proxy.annotations via ArgoCD helm.values
# or update external-dns to use --domain-filter for build-scoped DNS.
# -----------------------------------------------------------------------------
global:
  hostSuffix: dev.goldenpathidp.io

# -----------------------------------------------------------------------------
# Image Configuration - Pinned Version
# -----------------------------------------------------------------------------
image:
  repository: kong
  tag: "3.6.1"
  pullPolicy: IfNotPresent

# -----------------------------------------------------------------------------
# Proxy Service (External LoadBalancer)
# -----------------------------------------------------------------------------
proxy:
  enabled: true
  type: LoadBalancer
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: nlb
    service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing
    external-dns.alpha.kubernetes.io/hostname: "*.dev.goldenpathidp.io"
  http:
    enabled: true
    containerPort: 8000
    servicePort: 80
  tls:
    enabled: true
    containerPort: 8443
    servicePort: 443

# -----------------------------------------------------------------------------
# Admin API (Internal Only)
# -----------------------------------------------------------------------------
admin:
  enabled: true
  type: ClusterIP
  http:
    enabled: true
    containerPort: 8001
    servicePort: 8001

# -----------------------------------------------------------------------------
# Kong Manager (UI) - Dev Only
# -----------------------------------------------------------------------------
manager:
  enabled: true
  type: ClusterIP
  http:
    enabled: true
    containerPort: 8002
    servicePort: 8002
  tls:
    enabled: false
  ingress:
    enabled: true
    ingressClassName: kong
    hostname: kong-manager.dev.goldenpathidp.io
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      konghq.com/strip-path: "false"
    tls: kong-manager-tls

# -----------------------------------------------------------------------------
# Ingress Controller
# -----------------------------------------------------------------------------
ingressController:
  enabled: true
  image:
    repository: kong/kubernetes-ingress-controller
    tag: "3.1.2"
    pullPolicy: IfNotPresent
  installCRDs: false
  env:
    kong_admin_token:
      valueFrom:
        secretKeyRef:
          name: kong-admin-secret
          key: admin-token
          optional: true

# -----------------------------------------------------------------------------
# Environment (DB-less mode for dev)
# -----------------------------------------------------------------------------
env:
  database: "off"
  proxy_access_log: /dev/stdout
  admin_access_log: /dev/stdout
  proxy_error_log: /dev/stderr
  admin_error_log: /dev/stderr
  # Kong Manager needs to know where Admin API is
  admin_gui_url: "https://kong-manager.dev.goldenpathidp.io"
  admin_gui_api_url: "http://dev-kong-kong-admin.kong-system.svc.cluster.local:8001"

# -----------------------------------------------------------------------------
# Resource Limits for Dev
# -----------------------------------------------------------------------------
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi
