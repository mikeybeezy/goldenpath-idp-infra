# Tempo Helm Values - Staging Environment
# Chart: grafana/tempo v1.10.x
# Managed by scripts/standardize_metadata.py
governance:
  id: HELM_TEMPO_STAGING
  owner: platform-team
  risk_profile: medium
  reliability: silver

# -----------------------------------------------------------------------------
# Deployment Mode: SingleBinary with S3 storage
# -----------------------------------------------------------------------------
tempo:
  image:
    repository: grafana/tempo
    tag: 2.3.1
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  # Retention: 14 days for staging
  retention: 336h

  # Storage: S3 for staging
  storage:
    trace:
      backend: s3
      s3:
        bucket: goldenpath-staging-tempo-traces
        region: eu-west-2
        # Use IRSA for authentication
        insecure: false
      wal:
        path: /var/tempo/wal

  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318
    jaeger:
      protocols:
        thrift_http:
          endpoint: 0.0.0.0:14268
    zipkin:
      endpoint: 0.0.0.0:9411

  querier:
    max_concurrent_queries: 20

  compactor:
    compaction:
      block_retention: 336h

service:
  type: ClusterIP

# WAL persistence only (traces go to S3)
persistence:
  enabled: true
  size: 10Gi
  storageClassName: gp3

serviceMonitor:
  enabled: true
  namespace: monitoring
  labels:
    release: kube-prometheus-stack

# IRSA configuration
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/goldenpath-staging-tempo
