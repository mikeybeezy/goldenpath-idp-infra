# Managed by scripts/standardize_metadata.py
# ArgoCD Helm Values - Dev Environment
# Chart: argo/argo-cd

# -----------------------------------------------------------------------------
# Controller (Application Controller)
# -----------------------------------------------------------------------------
controller:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argocd
      additionalLabels:
        release: dev-kube-prometheus-stack

# -----------------------------------------------------------------------------
# Server Ingress Configuration - Kong
# -----------------------------------------------------------------------------
server:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argocd
      additionalLabels:
        release: dev-kube-prometheus-stack
  ingress:
    enabled: true
    ingressClassName: kong
    hostname: argocd.dev.goldenpathidp.io
    hosts:
      - argocd.dev.goldenpathidp.io
    tls:
      - hosts:
          - argocd.dev.goldenpathidp.io
        secretName: argocd-server-tls
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-staging
  # Required for ingress to work - ArgoCD uses gRPC
  extraArgs:
    - --insecure  # TLS terminated at Kong

configs:
  cm:
    resource.customizations: "cert-manager.io/Certificate:\n  health.lua: |\n    hs\
      \ = {}\n    if obj.status ~= nil and obj.status.conditions ~= nil then\n   \
      \   for i, condition in ipairs(obj.status.conditions) do\n        if condition.type\
      \ == \"Ready\" and condition.status == \"True\" then\n          hs.status =\
      \ \"Healthy\"\n          hs.message = condition.message or \"Ready\"\n     \
      \     return hs\n        end\n        if condition.type == \"Ready\" and condition.status\
      \ == \"False\" then\n          hs.status = \"Degraded\"\n          hs.message\
      \ = condition.message or \"Not Ready\"\n          return hs\n        end\n \
      \     end\n    end\n    hs.status = \"Progressing\"\n    hs.message = \"Waiting\
      \ for Ready condition\"\n    return hs\ncert-manager.io/ClusterIssuer:\n  health.lua:\
      \ |\n    hs = {}\n    if obj.status ~= nil and obj.status.conditions ~= nil\
      \ then\n      for i, condition in ipairs(obj.status.conditions) do\n       \
      \ if condition.type == \"Ready\" and condition.status == \"True\" then\n   \
      \       hs.status = \"Healthy\"\n          hs.message = condition.message or\
      \ \"Ready\"\n          return hs\n        end\n        if condition.type ==\
      \ \"Ready\" and condition.status == \"False\" then\n          hs.status = \"\
      Degraded\"\n          hs.message = condition.message or \"Not Ready\"\n    \
      \      return hs\n        end\n      end\n    end\n    hs.status = \"Progressing\"\
      \n    hs.message = \"Waiting for Ready condition\"\n    return hs\nconfiguration.konghq.com/KongPlugin:\n\
      \  health.lua: |\n    hs = {}\n    if obj.status ~= nil and obj.status.conditions\
      \ ~= nil then\n      for i, condition in ipairs(obj.status.conditions) do\n\
      \        if condition.type == \"Accepted\" and condition.status == \"False\"\
      \ then\n          hs.status = \"Degraded\"\n          hs.message = condition.message\
      \ or \"Not accepted\"\n          return hs\n        end\n      end\n    end\n\
      \    hs.status = \"Healthy\"\n    hs.message = \"Assumed healthy\"\n    return\
      \ hs\nconfiguration.konghq.com/KongIngress:\n  health.lua: |\n    hs = {}\n\
      \    hs.status = \"Healthy\"\n    hs.message = \"Assumed healthy\"\n    return\
      \ hs\nconfiguration.konghq.com/KongConsumer:\n  health.lua: |\n    hs = {}\n\
      \    hs.status = \"Healthy\"\n    hs.message = \"Assumed healthy\"\n    return\
      \ hs\nconfiguration.konghq.com/KongClusterPlugin:\n  health.lua: |\n    hs =\
      \ {}\n    hs.status = \"Healthy\"\n    hs.message = \"Assumed healthy\"\n  \
      \  return hs\n"
# -----------------------------------------------------------------------------
# Redis (used for caching)
# -----------------------------------------------------------------------------
redis:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argocd
      additionalLabels:
        release: dev-kube-prometheus-stack

# -----------------------------------------------------------------------------
# Repo Server
# -----------------------------------------------------------------------------
repoServer:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argocd
      additionalLabels:
        release: dev-kube-prometheus-stack

# -----------------------------------------------------------------------------
# ApplicationSet Controller
# -----------------------------------------------------------------------------
applicationSet:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argocd
      additionalLabels:
        release: dev-kube-prometheus-stack

# -----------------------------------------------------------------------------
# Notifications Controller
# -----------------------------------------------------------------------------
notifications:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argocd
      additionalLabels:
        release: dev-kube-prometheus-stack

# -----------------------------------------------------------------------------
# Governance Metadata
# -----------------------------------------------------------------------------
governance:
  id: HELM_ARGOCD_METADATA
  owner: null
  risk_profile: null
  reliability: null
