# Backstage Helm Values - Local Environment (Kind)
# Chart: backstage/backstage v1.12.0
# Purpose: Local development without AWS dependencies
governance:
  id: HELM_BACKSTAGE_LOCAL_METADATA
  owner: null
  risk_profile: null
  reliability: null

# -----------------------------------------------------------------------------
# Image Configuration - Pinned Version
# -----------------------------------------------------------------------------
backstage:
  image:
    registry: ghcr.io
    repository: backstage/backstage
    tag: 1.24.0
    pullPolicy: IfNotPresent

# -----------------------------------------------------------------------------
# App Configuration
# -----------------------------------------------------------------------------
appConfig:
  app:
    baseUrl: http://backstage.localhost:7007
    title: Goldenpath IDP (Local)

  backend:
    baseUrl: http://backstage.localhost:7007
    cors:
      origin: http://backstage.localhost:7007
    database:
      client: pg
      connection:
        host: ${POSTGRES_HOST}
        port: ${POSTGRES_PORT}
        user: ${POSTGRES_USER}
        password: ${POSTGRES_PASSWORD}

  # Catalog locations
  catalog:
    locations:
      - type: url
        target: https://raw.githubusercontent.com/mikeybeezy/goldenpath-idp-infra/main/backstage/templates/ci-apply-dev/template.yaml
        rules:
          - allow:
              - Template
      - type: url
        target: https://raw.githubusercontent.com/mikeybeezy/goldenpath-idp-infra/main/backstage/templates/app-template/template.yaml
        rules:
          - allow:
              - Template

  # GitHub Integration (optional for local - can use dummy token)
  integrations:
    github:
      - host: github.com
        token: ${GITHUB_TOKEN}

  # Auth disabled for local development (guest access)
  auth:
    environment: development
    providers: {}

# -----------------------------------------------------------------------------
# PostgreSQL (Bundled for Local)
# -----------------------------------------------------------------------------
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: 15.6.0-debian-12-r8
  auth:
    existingSecret: backstage-postgres-secret
    secretKeys:
      adminPasswordKey: postgres-password
      userPasswordKey: password
  primary:
    persistence:
      enabled: true
      size: 1Gi

# -----------------------------------------------------------------------------
# Ingress (Local)
# -----------------------------------------------------------------------------
ingress:
  enabled: true
  className: nginx
  host: backstage.localhost
  annotations: {}

# -----------------------------------------------------------------------------
# Environment Variables from Secrets
# -----------------------------------------------------------------------------
extraEnvVarsSecrets:
  - backstage-secrets

# -----------------------------------------------------------------------------
# Resource Limits (reduced for local)
# -----------------------------------------------------------------------------
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 250m
    memory: 512Mi
