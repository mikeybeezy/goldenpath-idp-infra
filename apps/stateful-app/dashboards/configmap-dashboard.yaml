# Managed by scripts/standardize_metadata.py
apiVersion: v1
kind: ConfigMap
metadata:
  name: '{{ values.app_name }}-dashboard'
  namespace: '{{ values.namespace }}'
  annotations:
    k8s-sidecar-target-directory: "/tmp/dashboards/{{ values.app_name }}"
    goldenpath.idp/id: APPS_DASHBOARDS_METADATA
    goldenpath.idp/owner: None
  labels:
    grafana_dashboard: '1'
    app: '{{ values.app_name }}'
data:
  '{{ values.app_name }}-dashboard.json': "{\n  \"title\": \"{{ values.app_name }}\
    \ - Golden Signals\",\n  \"tags\": [ \"golden-path\", \"{{ values.team }}\", \"\
    {{ values.env }}\" ],\n  \"timezone\": \"browser\",\n  \"schemaVersion\": 30,\n\
    \  \"refresh\": \"1m\",\n  \"editable\": false,\n  \"panels\": [\n    {\n    \
    \  \"type\": \"row\",\n      \"title\": \"Application Health (Golden Signals)\"\
    ,\n      \"gridPos\": { \"h\": 1, \"w\": 24, \"x\": 0, \"y\": 0 }\n    },\n  \
    \  {\n      \"title\": \"Request Rate (RPS)\",\n      \"type\": \"timeseries\"\
    ,\n      \"gridPos\": { \"h\": 8, \"w\": 8, \"x\": 0, \"y\": 1 },\n      \"targets\"\
    : [\n        {\n          \"expr\": \"sum(rate(http_requests_total{app=\\\"{{\
    \ values.app_name }}\\\", namespace=\\\"{{ values.namespace }}\\\"}[2m])) by (method)\"\
    ,\n          \"legendFormat\": \"{{method}}\"\n        }\n      ],\n      \"unit\"\
    : \"reqps\"\n    },\n    {\n      \"title\": \"Error Rate (%)\",\n      \"type\"\
    : \"timeseries\",\n      \"gridPos\": { \"h\": 8, \"w\": 8, \"x\": 8, \"y\": 1\
    \ },\n      \"targets\": [\n        {\n          \"expr\": \"sum(rate(http_requests_total{app=\\\
    \"{{ values.app_name }}\\\", namespace=\\\"{{ values.namespace }}\\\", status=~\\\
    \"5.*\\\"}[2m])) / sum(rate(http_requests_total{app=\\\"{{ values.app_name }}\\\
    \", namespace=\\\"{{ values.namespace }}\\\"}[2m])) * 100\",\n          \"legendFormat\"\
    : \"5xx Errors\"\n        }\n      ],\n      \"unit\": \"percent\",\n      \"\
    thresholds\": {\n        \"mode\": \"absolute\",\n        \"steps\": [\n     \
    \     { \"color\": \"green\", \"value\": null },\n          { \"color\": \"red\"\
    , \"value\": 1 }\n        ]\n      }\n    },\n    {\n      \"title\": \"Latency\
    \ (P95)\",\n      \"type\": \"timeseries\",\n      \"gridPos\": { \"h\": 8, \"\
    w\": 8, \"x\": 16, \"y\": 1 },\n      \"targets\": [\n        {\n          \"\
    expr\": \"histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{app=\\\
    \"{{ values.app_name }}\\\", namespace=\\\"{{ values.namespace }}\\\"}[5m])) by\
    \ (le))\",\n          \"legendFormat\": \"P95\"\n        }\n      ],\n      \"\
    unit\": \"s\"\n    },\n    {\n      \"type\": \"row\",\n      \"title\": \"Infrastructure\
    \ Saturation\",\n      \"gridPos\": { \"h\": 1, \"w\": 24, \"x\": 0, \"y\": 9\
    \ }\n    },\n    {\n      \"title\": \"CPU Usage\",\n      \"type\": \"timeseries\"\
    ,\n      \"gridPos\": { \"h\": 8, \"w\": 12, \"x\": 0, \"y\": 10 },\n      \"\
    targets\": [\n        {\n          \"expr\": \"sum(rate(container_cpu_usage_seconds_total{pod=~\\\
    \"{{ values.app_name }}-.*\\\", namespace=\\\"{{ values.namespace }}\\\"}[2m]))\
    \ by (pod)\",\n          \"legendFormat\": \"{{pod}}\"\n        }\n      ],\n\
    \      \"unit\": \"short\"\n    },\n    {\n      \"title\": \"Memory Usage\",\n\
    \      \"type\": \"timeseries\",\n      \"gridPos\": { \"h\": 8, \"w\": 12, \"\
    x\": 12, \"y\": 10 },\n      \"targets\": [\n        {\n          \"expr\": \"\
    sum(container_memory_usage_bytes{pod=~\\\"{{ values.app_name }}-.*\\\", namespace=\\\
    \"{{ values.namespace }}\\\"}) by (pod)\",\n          \"legendFormat\": \"{{pod}}\"\
    \n        }\n      ],\n      \"unit\": \"bytes\"\n    },\n    {\n      \"type\"\
    : \"row\",\n      \"title\": \"Log Investigation (Recent Errors)\",\n      \"\
    gridPos\": { \"h\": 1, \"w\": 24, \"x\": 0, \"y\": 18 }\n    },\n    {\n     \
    \ \"type\": \"logs\",\n      \"title\": \"Recent Application Logs\",\n      \"\
    gridPos\": { \"h\": 10, \"w\": 24, \"x\": 0, \"y\": 19 },\n      \"targets\":\
    \ [\n        {\n          \"expr\": \"{app=\\\"{{ values.app_name }}\\\", namespace=\\\
    \"{{ values.namespace }}\\\"} |= \\\"error\\\"\",\n          \"legendFormat\"\
    : \"\"\n        }\n      ],\n      \"options\": {\n        \"showTime\": true,\n\
    \        \"showLabels\": false,\n        \"wrapLogMessage\": true,\n        \"\
    sortOrder\": \"Descending\"\n      }\n    }\n  ]\n}\n"
