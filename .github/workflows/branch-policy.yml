# Owner: platform
name: Policy - Branch Policy Guard

on:
  pull_request:
    branches:
      - main
      - development

jobs:
  enforce-development-only:
    runs-on: ubuntu-latest
    steps:
      - name: Enforce development -> main
        run: |
          base_ref="${{ github.base_ref }}"
          head_ref="${{ github.head_ref }}"
          if [[ "${base_ref}" == "main" ]]; then
            allowed_heads=("development" "dev-feature")
            if [[ ! " ${allowed_heads[*]} " =~ " ${head_ref} " ]]; then
              echo "Only development or dev-feature may merge to main." >&2
              echo "Open a PR from development or dev-feature instead." >&2
              exit 1
            fi
            echo "Allowed: ${head_ref} -> ${base_ref}"
          else
            echo "Allowed: ${head_ref} -> ${base_ref}"
          fi
      - name: Runbook link
        if: always()
        run: |
          echo "Runbook: docs/adrs/ADR-0028-platform-dev-branch-gate.md" >> "${GITHUB_STEP_SUMMARY}"
